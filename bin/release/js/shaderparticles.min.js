/* Shader-Particles 0.8.2
 * 
 * (c) 2013 Luke Moody (http://www.github.com/squarefeet) & Lee Stemkoski (http://www.adelphi.edu/~stemkoski/)
 *     Based on Lee Stemkoski's original work (https://github.com/stemkoski/stemkoski.github.com/blob/master/Three.js/js/ParticleEngine.js).
 *
 * Shader-Particles may be freely distributed under the MIT license (See LICENSE.txt at root of this repository.)
 */
var SPE=SPE||{};SPE.utils={randomVector3:function(a,b){var c=new THREE.Vector3;return this.randomizeExistingVector3(c,a,b),c},randomColor:function(a,b){var c=new THREE.Color;return this.randomizeExistingColor(c,a,b),c},randomFloat:function(a,b){return a+b*(Math.random()-.5)},randomVector3OnSphere:function(a,b,c,d,e){var f=new THREE.Vector3;return this.randomizeExistingVector3OnSphere(f,a,b,c,d,e),f},randomVector3OnDisk:function(a,b,c,d,e){var f=new THREE.Vector3;return this.randomizeExistingVector3OnDisk(f,a,b,c,d,e),f},randomVelocityVector3OnSphere:function(a,b,c,d,e){var f=new THREE.Vector3;return this.randomizeExistingVelocityVector3OnSphere(f,a,b,c,d),e&&f.multiply(e),f},randomizeExistingVector3:function(a,b,c){a.copy(b),a.x+=Math.random()*c.x-c.x/2,a.y+=Math.random()*c.y-c.y/2,a.z+=Math.random()*c.z-c.z/2},randomizeExistingColor:function(a,b,c){a.copy(b),a.r+=Math.random()*c.x-c.x/2,a.g+=Math.random()*c.y-c.y/2,a.b+=Math.random()*c.z-c.z/2,a.r=Math.max(0,Math.min(a.r,1)),a.g=Math.max(0,Math.min(a.g,1)),a.b=Math.max(0,Math.min(a.b,1))},randomizeExistingVector3OnSphere:function(a,b,c,d,e,f){var g=2*Math.random()-1,h=6.2832*Math.random(),i=Math.sqrt(1-g*g),j=this.randomFloat(c,d);f&&(j=Math.round(j/f)*f),a.set(i*Math.cos(h)*j,i*Math.sin(h)*j,g*j).multiply(e),a.add(b)},randomizeExistingVector3OnDisk:function(a,b,c,d,e,f){var g=6.2832*Math.random(),h=Math.abs(this.randomFloat(c,d));f&&(h=Math.round(h/f)*f),a.set(Math.cos(g),Math.sin(g),0).multiplyScalar(h),e&&a.multiply(e),a.add(b)},randomizeExistingVelocityVector3OnSphere:function(a,b,c,d,e){a.copy(c).sub(b).normalize().multiplyScalar(Math.abs(this.randomFloat(d,e)))},generateID:function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return a=a.replace(/[xy]/g,function(a){var b=Math.random(),c=16*b|0,d="x"===a?c:3&c|8;return d.toString(16)})}};var SPE=SPE||{};SPE.Group=function(a){var b=this;b.fixedTimeStep=parseFloat("number"==typeof a.fixedTimeStep?a.fixedTimeStep:.016),b.maxAge=parseFloat(a.maxAge||3),b.texture=a.texture||null,b.hasPerspective="boolean"==typeof a.hasPerspective?a.hasPerspective:"number"==typeof a.hasPerspective?!!a.hasPerspective:!0,b.colorize="boolean"==typeof a.colorize?a.colorize:"number"==typeof a.colorize?!!a.colorize:!0,b.blending="number"==typeof a.blending?a.blending:THREE.AdditiveBlending,b.transparent="boolean"==typeof a.transparent?a.transparent:!0,b.alphaTest="number"==typeof a.alphaTest?a.alphaTest:.5,b.depthWrite="boolean"==typeof a.depthWrite?a.depthWrite:!1,b.depthTest="boolean"==typeof a.depthTest?a.depthTest:!0,b.fog="boolean"==typeof a.fog?a.fog:!0,b.uniforms={duration:{type:"f",value:b.maxAge},texture:{type:"t",value:b.texture},fogColor:{type:"c",value:new THREE.Color},fogNear:{type:"f",value:10},fogFar:{type:"f",value:200},fogDensity:{type:"f",value:.5}},b.attributes={acceleration:{type:"v3",value:[]},velocity:{type:"v3",value:[]},alive:{type:"f",value:[]},age:{type:"f",value:[]},size:{type:"v3",value:[]},angle:{type:"v4",value:[]},colorStart:{type:"c",value:[]},colorMiddle:{type:"c",value:[]},colorEnd:{type:"c",value:[]},opacity:{type:"v3",value:[]},pos:{type:"v3",value:[]}},b.defines={HAS_PERSPECTIVE:b.hasPerspective,COLORIZE:b.colorize},b.emitters=[],b._pool=[],b._poolCreationSettings=null,b._createNewWhenPoolEmpty=0,b.maxAgeMilliseconds=1e3*b.maxAge,b.geometry=new THREE.Geometry,b.material=new THREE.ShaderMaterial({uniforms:b.uniforms,attributes:b.attributes,vertexShader:SPE.shaders.vertex,fragmentShader:SPE.shaders.fragment,blending:b.blending,transparent:b.transparent,alphaTest:b.alphaTest,depthWrite:b.depthWrite,depthTest:b.depthTest,defines:b.defines,fog:b.fog}),b.mesh=new THREE.PointCloud(b.geometry,b.material),b.mesh.dynamic=!0},SPE.Group.prototype={_flagUpdate:function(){var a=this;return a.attributes.age.needsUpdate=!0,a.attributes.alive.needsUpdate=!0,a.attributes.pos.needsUpdate=!0,a},addEmitter:function(a){var b=this;a.particlesPerSecond=a.duration?a.particleCount/(b.maxAge<a.duration?b.maxAge:a.duration)|0:a.particleCount/b.maxAge|0;var c=b.geometry.vertices,d=c.length,e=a.particleCount+d,f=b.attributes,g=f.acceleration.value,h=f.velocity.value,i=f.alive.value,j=f.age.value,k=f.size.value,l=f.angle.value,m=f.colorStart.value,n=f.colorMiddle.value,o=f.colorEnd.value,p=f.opacity.value,q=f.pos.value;a.particleIndex=parseFloat(d);for(var r=d;e>r;++r)"sphere"===a.type?(q[r]=b.randomVector3OnSphere(a._position,a._radius,a._radiusSpread,a._radiusScale,a._radiusSpreadClamp),c[r]=q[r],h[r]=b.randomVelocityVector3OnSphere(q[r],a._position,a._speed,a._speedSpread)):"disk"===a.type?(q[r]=b.randomVector3OnDisk(a._position,a._radius,a._radiusSpread,a._radiusScale,a._radiusSpreadClamp),c[r]=q[r],h[r]=b.randomVelocityVector3OnSphere(q[r],a._position,a._speed,a._speedSpread)):(q[r]=b.randomVector3(a._position,a._positionSpread),c[r]=q[r],h[r]=b.randomVector3(a._velocity,a._velocitySpread)),g[r]=b.randomVector3(a._acceleration,a._accelerationSpread),k[r]=new THREE.Vector3(Math.abs(b.randomFloat(a._sizeStart,a._sizeStartSpread)),Math.abs(b.randomFloat(a._sizeMiddle,a._sizeMiddleSpread)),Math.abs(b.randomFloat(a._sizeEnd,a._sizeEndSpread))),l[r]=new THREE.Vector4(b.randomFloat(a._angleStart,a._angleStartSpread),b.randomFloat(a._angleMiddle,a._angleMiddleSpread),b.randomFloat(a._angleEnd,a._angleEndSpread),a.angleAlignVelocity?1:0),j[r]=0,i[r]=a.isStatic?1:0,m[r]=b.randomColor(a._colorStart,a._colorStartSpread),n[r]=b.randomColor(a._colorMiddle,a._colorMiddleSpread),o[r]=b.randomColor(a._colorEnd,a._colorEndSpread),p[r]=new THREE.Vector3(Math.abs(b.randomFloat(a._opacityStart,a._opacityStartSpread)),Math.abs(b.randomFloat(a._opacityMiddle,a._opacityMiddleSpread)),Math.abs(b.randomFloat(a._opacityEnd,a._opacityEndSpread)));return a.verticesIndex=parseFloat(d),a.attributes=f,a.vertices=b.geometry.vertices,a.geometry=b.geometry,a.maxAge=b.maxAge,a.__id=b.generateID(),a.isStatic||b.emitters.push(a),b},removeEmitter:function(a){var b,c=this.emitters;if(a instanceof SPE.Emitter)b=a.__id;else{if("string"!=typeof a)return void console.warn("Invalid emitter or emitter ID passed to SPE.Group#removeEmitter.");b=a}for(var d=0,e=c.length;e>d;++d)if(c[d].__id===b){c.splice(d,1);break}},tick:function(a){var b=this,c=b.emitters,d=c.length;if(a=a||b.fixedTimeStep,0!==d){for(var e=0;d>e;++e)c[e].tick(a);return b._flagUpdate(),b}},getFromPool:function(){var a=this,b=a._pool,c=a._createNewWhenPoolEmpty;return b.length?b.pop():c?new SPE.Emitter(a._poolCreationSettings):null},releaseIntoPool:function(a){return a instanceof SPE.Emitter?(a.reset(),this._pool.unshift(a),this):void console.error("Will not add non-emitter to particle group pool:",a)},getPool:function(){return this._pool},addPool:function(a,b,c){var d,e=this;e._poolCreationSettings=b,e._createNewWhenPoolEmpty=!!c;for(var f=0;a>f;++f)d=new SPE.Emitter(b),e.addEmitter(d),e.releaseIntoPool(d);return e},_triggerSingleEmitter:function(a){var b=this,c=b.getFromPool();return null===c?void console.log("SPE.Group pool ran out."):(a instanceof THREE.Vector3&&c._position.copy(a),c.enable(),setTimeout(function(){c.disable(),b.releaseIntoPool(c)},b.maxAgeMilliseconds),b)},triggerPoolEmitter:function(a,b){var c=this;if("number"==typeof a&&a>1)for(var d=0;a>d;++d)c._triggerSingleEmitter(b);else c._triggerSingleEmitter(b);return c}};for(var i in SPE.utils)SPE.Group.prototype[i]=SPE.utils[i];SPE.shaders={vertex:["uniform float duration;","uniform float scale;","attribute vec3 colorStart;","attribute vec3 colorMiddle;","attribute vec3 colorEnd;","attribute vec3 opacity;","attribute vec3 acceleration;","attribute vec3 velocity;","attribute float alive;","attribute float age;","attribute vec3 size;","attribute vec4 angle;","attribute vec3 pos;","varying vec4 vColor;","varying float vAngle;",THREE.ShaderChunk.common,THREE.ShaderChunk.logdepthbuf_pars_vertex,"vec4 GetPos() {","   vec3 newPos = vec3( pos );","   vec3 a = acceleration * age;","   vec3 v = velocity * age;","   v = v + (a * age);","   newPos = newPos + v;","   vec4 mvPosition = modelViewMatrix * vec4( newPos, 1.0 );","   return mvPosition;","}","void main() {","   float positionInTime = (age / duration);","   float halfDuration = 0.5 * duration;","   float lerpAmount = 0.0;","   float pointSize = 0.0;","   float deadPos = 1000000000.0;","   vAngle = 0.0;","   if( alive == 1.0 ) {","       vec4 currentPos = GetPos();","       if( positionInTime < 0.5 ) {","           lerpAmount = age / halfDuration;","           vColor = vec4( mix( colorStart, colorMiddle, lerpAmount ), mix( opacity.x, opacity.y, lerpAmount ) );","           pointSize = mix( size.x, size.y, lerpAmount );","           vAngle = mix( angle.x, angle.y, lerpAmount );","       }","       else {","           lerpAmount = ( age - halfDuration ) / halfDuration;","           vColor = vec4( mix( colorMiddle, colorEnd, lerpAmount ), mix( opacity.y, opacity.z, lerpAmount ) );","           pointSize = mix( size.y, size.z, lerpAmount );","           vAngle = mix( angle.y, angle.z, lerpAmount );","       }","       if( angle.w == 1.0 ) {","           vAngle = -atan( currentPos.y, currentPos.x );","       }","       #ifdef HAS_PERSPECTIVE","           pointSize = pointSize * ( 300.0 / length( currentPos.xyz ) );","       #endif","       gl_PointSize = pointSize;","       gl_Position = projectionMatrix * currentPos;","   }","   else {","       vColor = vec4( 0.0 );","       gl_Position = vec4( deadPos, deadPos, deadPos, 0.0 );","   }",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragment:["uniform sampler2D texture;",THREE.ShaderChunk.common,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec4 vColor;","varying float vAngle;","void main() {","   vec3 outgoingLight = vColor.xyz;","   float c = cos( vAngle );","   float s = sin( vAngle );","   float x = gl_PointCoord.x - 0.5;","   float y = gl_PointCoord.y - 0.5;","   vec2 rotatedUV = vec2( c * x + s * y + 0.5, c * y - s * x + 0.5 );","   vec4 rotatedTexture = texture2D( texture, rotatedUV );",THREE.ShaderChunk.logdepthbuf_fragment,"   #ifdef COLORIZE","      outgoingLight = vColor.xyz * rotatedTexture.xyz;","   #else","      outgoingLight = vec3( rotatedTexture.xyz );","   #endif",THREE.ShaderChunk.fog_fragment,"   gl_FragColor = vec4( outgoingLight.xyz, rotatedTexture.w * vColor.w );","}"].join("\n")};var SPE=SPE||{};SPE.Emitter=function(a){a=a||{};var b=this;b._updateFlags={},b._updateCounts={},b._particleCount=100,b._type="cube",b._position=new THREE.Vector3,b._positionSpread=new THREE.Vector3,b._radius=10,b._radiusSpread=0,b._radiusScale=new THREE.Vector3(1,1,1),b._radiusSpreadClamp=0,b._acceleration=new THREE.Vector3,b._accelerationSpread=new THREE.Vector3,b._velocity=new THREE.Vector3,b._velocitySpread=new THREE.Vector3,b._speed=0,b._speedSpread=0,b._sizeStart=1,b._sizeStartSpread=0,b._sizeEnd=1,b._sizeEndSpread=0,b._sizeMiddle=Math.abs(b._sizeEnd+b._sizeStart)/2,b._sizeMiddleSpread=0,b._angleStart=0,b._angleStartSpread=0,b._angleMiddle=0,b._angleMiddleSpread=0,b._angleEnd=0,b._angleEndSpread=0,b._angleAlignVelocity=!1,b._colorStart=new THREE.Color("white"),b._colorStartSpread=new THREE.Vector3,b._colorEnd=b._colorStart.clone(),b._colorEndSpread=new THREE.Vector3,b._colorMiddle=(new THREE.Color).addColors(b._colorStart,b._colorEnd).multiplyScalar(.5),b._colorMiddleSpread=new THREE.Vector3,b._opacityStart=1,b._opacityStartSpread=0,b._opacityEnd=0,b._opacityEndSpread=0,b._opacityMiddle=Math.abs(b._opacityEnd+b._opacityStart)/2,b._opacityMiddleSpread=0;var c=Object.keys(a),d=!!~c.indexOf("sizeMiddle"),e=!!~c.indexOf("angleMiddle"),f=!!~c.indexOf("colorMiddle"),g=!!~c.indexOf("opacityMiddle");for(var h in a)b.hasOwnProperty("_"+h)&&(b[h]=a[h]);d||(b.sizeMiddle=Math.abs(b._sizeEnd+b._sizeStart)/2),e||(b.angleMiddle=Math.abs(b._angleEnd+b._angleStart)/2),f||(b.colorMiddle=Math.abs(b._colorEnd+b._colorStart)/2),g||(b.opacityMiddle=Math.abs(b._opacityEnd+b._opacityStart)/2),b.duration="number"==typeof a.duration?a.duration:null,b.alive=parseFloat("number"==typeof a.alive?a.alive:1),b.isStatic="number"==typeof a.isStatic?!!a.isStatic:"boolean"==typeof a.isStatic?a.isStatic:!1,b.onParticleSpawn="function"==typeof a.onParticleSpawn?a.onParticleSpawn:null,b.particlesPerSecond=0,b.attributes=null,b.vertices=null,b.verticesIndex=0,b.age=0,b.maxAge=0,b.particleIndex=0,b.hasRendered=!1,b.attributesNeedUpdate=!1,b.__id=null,b.userData={}},SPE.Emitter.prototype={_resetParticle:function(a){var b=this,c=b._type,d=b.positionSpread,e=b.attributes,f=e.pos.value[a],g=e.velocity.value[a],h=e.acceleration.value[a],i=b.velocitySpread,j=b.accelerationSpread;"cube"===c&&0===d.x&&0===d.y&&0===d.z||"sphere"===c&&0===b.radius||"disk"===c&&0===b.radius?(f.copy(b._position),b.randomizeExistingVector3(g,b._velocity,i),e.velocity.needsUpdate=!0,"cube"===c&&(b.randomizeExistingVector3(h,b.acceleration,j),e.acceleration.needsUpdate=!0)):"cube"===c?(b.randomizeExistingVector3(f,b._position,d),b.randomizeExistingVector3(g,b._velocity,i),b.randomizeExistingVector3(h,b.acceleration,j),e.velocity.needsUpdate=!0,e.acceleration.needsUpdate=!0):"sphere"===c?(b.randomizeExistingVector3OnSphere(f,b._position,b._radius,b._radiusSpread,b._radiusScale,b._radiusSpreadClamp),b.randomizeExistingVelocityVector3OnSphere(g,b._position,f,b._speed,b._speedSpread),b.randomizeExistingVector3(h,b.acceleration,j),e.velocity.needsUpdate=!0,e.acceleration.needsUpdate=!0):"disk"===c&&(b.randomizeExistingVector3OnDisk(f,b._position,b._radius,b._radiusSpread,b._radiusScale,b._radiusSpreadClamp),b.randomizeExistingVelocityVector3OnSphere(g,b.position,f,b._speed,b._speedSpread),b.randomizeExistingVector3(h,b.acceleration,j),e.velocity.needsUpdate=!0,e.acceleration.needsUpdate=!0),b._updateParticlesFromFlags(a),"function"==typeof b.onParticleSpawn&&b.onParticleSpawn(e,a)},_updateParticlesFromFlags:function(a){if(this.hasRendered){var b=this,c=b._updateFlags,d=b._updateCounts,e=b._particleCount,f=b.attributes,g=b.attributesNeedUpdate,h=b.vertices,i=b.verticesIndex,j=i+e,k=f.pos.value,l=b.type;if(c.position===!0&&g===!0){if("cube"===l&&0===b._positionSpread.x&&0===b._positionSpread.y&&0===b._positionSpread.z||"sphere"===l&&0===b._radius||"disk"===l&&0===b._radius)for(var m=i,n=b.position;j>m;++m)k[m].copy(n),h[m].copy(n);else if("cube"===l)for(var m=i,n=b._position;j>m;++m)b.randomizeExistingVector3(k[m],n,b._positionSpread),h[m].copy(n);else if("sphere"===l)for(var m=i,n=b._position;j>m;++m)b.randomizeExistingVector3OnSphere(k[m],b._position,b._radius,b._radiusSpread,b._radiusScale,b._radiusSpreadClamp),h[m].copy(n);else if("disk"===l)for(var m=i,n=b._position;j>m;++m)b.randomizeExistingVector3OnDisk(k[m],b._position,b._radius,b._radiusSpread,b._radiusScale,b._radiusSpreadClamp),h[m].copy(n);b.geometry.verticesNeedUpdate=!0,c.position=!1}if(c.velocity===!0&&g===!0){if("cube"===l)for(var m=i;j>m;++m)b.randomizeExistingVector3(f.velocity.value[m],b._velocity,b._velocitySpread);else if("sphere"===l||"disk"===l)for(var m=i,n=b.position;j>m;++m)b.randomizeExistingVelocityVector3OnSphere(f.velocity.value[m],n,k[m],b._speed,b._speedSpread);f.velocity.needsUpdate=!0,c.velocity=!1}if(c.acceleration===!0&&g===!0&&"cube"===l){for(var m=i,o=f.acceleration.value;j>m;++m)b.randomizeExistingVector3(o[m],b._acceleration,b._accelerationSpread);f.acceleration.needsUpdate=!0,c.acceleration=!1}if(c.sizeStart===!0){if(g===!0)for(var m=i,p=f.size.value;j>m;++m)p[m].x=Math.abs(b.randomFloat(b._sizeStart,b._sizeStartSpread));else f.size.value[a].x=Math.abs(b.randomFloat(b._sizeStart,b._sizeStartSpread));f.size.needsUpdate=!0,++d.sizeStart===e&&(d.sizeStart=0,c.sizeStart=!1)}if(c.sizeMiddle===!0){if(g===!0)for(var m=i,p=f.size.value;j>m;++m)p[m].y=Math.abs(b.randomFloat(b._sizeMiddle,b._sizeMiddleSpread));else f.size.value[a].y=Math.abs(b.randomFloat(b._sizeMiddle,b._sizeMiddleSpread));f.size.needsUpdate=!0,++d.sizeMiddle===e&&(d.sizeMiddle=0,c.sizeMiddle=!1)}if(c.sizeEnd===!0){if(g===!0)for(var m=i,p=f.size.value;j>m;++m)p[m].z=Math.abs(b.randomFloat(b._sizeEnd,b._sizeEndSpread));else f.size.value[a].z=Math.abs(b.randomFloat(b._sizeEnd,b._sizeEndSpread));f.size.needsUpdate=!0,++d.sizeEnd===e&&(d.sizeEnd=0,c.sizeEnd=!1)}if(c.colorStart===!0){if(g===!0)for(var m=i,p=f.colorStart.value;j>m;++m)b.randomizeExistingColor(p[m],b._colorStart,b._colorStartSpread);else b.randomizeExistingColor(f.colorStart.value[a],b._colorStart,b._colorStartSpread);f.colorStart.needsUpdate=!0,++d.colorStart===e&&(d.colorStart=0,c.colorStart=!1)}if(c.colorMiddle===!0){if(g===!0)for(var m=i,p=f.colorMiddle.value;j>m;++m)b.randomizeExistingColor(p[m],b._colorMiddle,b._colorMiddleSpread);else b.randomizeExistingColor(f.colorMiddle.value[a],b._colorMiddle,b._colorMiddleSpread);f.colorMiddle.needsUpdate=!0,++d.colorMiddle===e&&(d.colorMiddle=0,c.colorMiddle=!1)}if(c.colorEnd===!0){if(g===!0)for(var m=i,p=f.colorEnd.value;j>m;++m)b.randomizeExistingColor(p[m],b._colorEnd,b._colorEndSpread);else b.randomizeExistingColor(f.colorEnd.value[a],b._colorEnd,b._colorEndSpread);f.colorEnd.needsUpdate=!0,++d.colorEnd===e&&(d.colorEnd=0,c.colorEnd=!1)}if(c.opacityStart===!0){if(g===!0)for(var m=i,p=f.opacity.value;j>m;++m)p[m].x=Math.abs(b.randomFloat(b._opacityStart,b._opacityStartSpread));else f.opacity.value[a].x=Math.abs(b.randomFloat(b._opacityStart,b._opacityStartSpread));f.opacity.needsUpdate=!0,++d.opacityStart===e&&(d.opacityStart=0,c.opacityStart=!1)}if(c.opacityMiddle===!0){if(g===!0)for(var m=i,p=f.opacity.value;j>m;++m)p[m].y=Math.abs(b.randomFloat(b._opacityMiddle,b._opacityMiddleSpread));else f.opacity.value[a].y=Math.abs(b.randomFloat(b._opacityMiddle,b._opacityMiddleSpread));f.opacity.needsUpdate=!0,++d.opacityMiddle===e&&(d.opacityMiddle=0,c.opacityMiddle=!1)}if(c.opacityEnd===!0){if(g===!0)for(var m=i,p=f.opacity.value;j>m;++m)p[m].z=Math.abs(b.randomFloat(b._opacityEnd,b._opacityEndSpread));else f.opacity.value[a].z=Math.abs(b.randomFloat(b._opacityEnd,b._opacityEndSpread));f.opacity.needsUpdate=!0,++d.opacityEnd===e&&(d.opacityEnd=0,c.opacityEnd=!1)}if(c.angleStart===!0){if(g===!0)for(var m=i,p=f.angle.value;j>m;++m)p[m].x=Math.abs(b.randomFloat(b._angleStart,b._angleStartSpread));else f.angle.value[a].x=Math.abs(b.randomFloat(b._angleStart,b._angleStartSpread));f.angle.needsUpdate=!0,++d.angleStart===e&&(d.angleStart=0,c.angleStart=!1)}if(c.angleMiddle===!0){if(g===!0)for(var m=i,p=f.angle.value;j>m;++m)p[m].y=Math.abs(b.randomFloat(b._angleMiddle,b._angleMiddleSpread));else f.angle.value[a].y=Math.abs(b.randomFloat(b._angleMiddle,b._angleMiddleSpread));f.angle.needsUpdate=!0,++d.angleMiddle===e&&(d.angleMiddle=0,c.angleMiddle=!1)}if(c.angleEnd===!0){if(g===!0)for(var m=i,p=f.angle.value;j>m;++m)p[m].z=Math.abs(b.randomFloat(b._angleEnd,b._angleEndSpread));else f.angle.value[a].z=Math.abs(b.randomFloat(b._angleEnd,b._angleEndSpread));f.angle.needsUpdate=!0,++d.angleEnd===e&&(d.angleEnd=0,c.angleEnd=!1)}b.attributesNeedUpdate=!1}},tick:function(a){if(this.hasRendered=!0,this.isStatic!==!0){for(var b=this,c=b.attributes,d=c.alive.value,e=c.age.value,f=b.verticesIndex,g=b._particleCount,h=f+g,i=b.particlesPerSecond*b.alive,j=i*a,k=b.maxAge,l=b.age,m=b.duration,n=b.particleIndex,o=f;h>o;++o)1===d[o]&&(e[o]+=a),e[o]>=k&&(e[o]=0,d[o]=0);if(0===b.alive)return void(b.age=0);if("number"==typeof m&&l>m)return b.alive=0,void(b.age=0);var p,q=Math.max(Math.min(h,n+j),0),r=0,s=0,t=0|n;for(o=t;q>o;++o)1!==d[o]&&++r;if(0!==r)for(p=a/r,o=t;q>o;++o,++s)1!==d[o]&&(d[o]=1,e[o]=p*s,b._resetParticle(o));b.particleIndex+=j,b.particleIndex<0&&(b.particleIndex=0),n>=f+g&&(b.particleIndex=parseFloat(f)),b.age+=a,b.age<0&&(b.age=0)}},reset:function(a){var b=this;if(b.age=0,b.alive=0,a)for(var c=b.verticesIndex,d=b.verticesIndex+b._particleCount,e=b.attributes,f=e.alive.value,g=e.age.value,h=c;d>h;++h)f[h]=0,g[h]=0;return b},enable:function(){this.alive=1},disable:function(){this.alive=0}},Object.defineProperty(SPE.Emitter.prototype,"type",{get:function(){return this._type},set:function(a){"cube"===a||"sphere"===a||"disk"===a?(this._type=a,this._updateFlags.type=!0):console.warn("Invalid emitter type: "+a+'. Emitter type not changed from "'+this._type+'"')}}),Object.defineProperty(SPE.Emitter.prototype,"particleCount",{get:function(){return this._particleCount},set:function(a){"number"==typeof a&&a>=1?this._particleCount=Math.round(a):console.warn("Invalid particleCount specified: "+a+". Must be a number >= 1. ParticleCount remains at: "+this._particleCount)}}),Object.defineProperty(SPE.Emitter.prototype,"position",{get:function(){return this._position},set:function(a){a instanceof THREE.Vector3?(this._position=a,this._updateFlags.position=!0):console.warn("Invalid position specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"positionSpread",{get:function(){return this._positionSpread},set:function(a){a instanceof THREE.Vector3?(this._positionSpread=a,this._updateFlags.position=!0):console.warn("Invalid positionSpread specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"radius",{get:function(){return this._radius},set:function(a){"number"==typeof a?(this._radius=a,this._updateFlags.position=!0):console.warn("Invalid radius specified: "+a+". Must be a number. radius remains at: "+this._radius)}}),Object.defineProperty(SPE.Emitter.prototype,"radiusSpread",{get:function(){return this._radiusSpread},set:function(a){"number"==typeof a?(this._radiusSpread=a,this._updateFlags.position=!0):console.warn("Invalid radiusSpread specified: "+a+". Must be a number. radiusSpread remains at: "+this._radiusSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(a){a instanceof THREE.Vector3?(this._radiusScale=a,this._updateFlags.position=!0):console.warn("Invalid radiusScale specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"radiusSpreadClamp",{get:function(){return this._radiusSpreadClamp},set:function(a){"number"==typeof a?(this._radiusSpreadClamp=a,this._updateFlags.position=!0):console.warn("Invalid radiusSpreadClamp specified: "+a+". Must be a number. radiusSpreadClamp remains at: "+this._radiusSpreadClamp)}}),Object.defineProperty(SPE.Emitter.prototype,"acceleration",{get:function(){return this._acceleration},set:function(a){a instanceof THREE.Vector3?(this._acceleration=a,this._updateFlags.acceleration=!0):console.warn("Invalid acceleration specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"accelerationSpread",{get:function(){return this._accelerationSpread},set:function(a){a instanceof THREE.Vector3?(this._accelerationSpread=a,this._updateFlags.acceleration=!0):console.warn("Invalid accelerationSpread specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"velocity",{get:function(){return this._velocity},set:function(a){a instanceof THREE.Vector3?(this._velocity=a,this._updateFlags.velocity=!0):console.warn("Invalid velocity specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"velocitySpread",{get:function(){return this._velocitySpread},set:function(a){a instanceof THREE.Vector3?(this._velocitySpread=a,this._updateFlags.velocity=!0):console.warn("Invalid velocitySpread specified. Must be instance of THREE.Vector3.")}}),Object.defineProperty(SPE.Emitter.prototype,"speed",{get:function(){return this._speed},set:function(a){"number"==typeof a?(this._speed=a,this._updateFlags.velocity=!0):console.warn("Invalid speed specified: "+a+". Must be a number. speed remains at: "+this._speed)}}),Object.defineProperty(SPE.Emitter.prototype,"speedSpread",{get:function(){return this._speedSpread},set:function(a){"number"==typeof a?(this._speedSpread=a,this._updateFlags.velocity=!0):console.warn("Invalid speedSpread specified: "+a+". Must be a number. speedSpread remains at: "+this._speedSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"sizeStart",{get:function(){return this._sizeStart},set:function(a){"number"==typeof a?(this._sizeStart=a,this._updateFlags.sizeStart=!0,this._updateCounts.sizeStart=0):console.warn("Invalid sizeStart specified: "+a+". Must be a number. sizeStart remains at: "+this._sizeStart)}}),Object.defineProperty(SPE.Emitter.prototype,"sizeStartSpread",{get:function(){return this._sizeStartSpread},set:function(a){"number"==typeof a?(this._sizeStartSpread=a,this._updateFlags.sizeStart=!0,this._updateCounts.sizeStart=0):console.warn("Invalid sizeStartSpread specified: "+a+". Must be a number. sizeStartSpread remains at: "+this._sizeStartSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"sizeMiddle",{get:function(){return this._sizeMiddle},set:function(a){this._sizeMiddle="number"==typeof a?a:Math.abs(this._sizeEnd+this._sizeStart),this._updateFlags.sizeMiddle=!0,this._updateCounts.sizeMiddle=0}}),Object.defineProperty(SPE.Emitter.prototype,"sizeMiddleSpread",{get:function(){return this._sizeMiddleSpread},set:function(a){"number"==typeof a?(this._sizeMiddleSpread=a,this._updateFlags.sizeMiddle=!0,this._updateCounts.sizeMiddle=0):console.warn("Invalid sizeMiddleSpread specified: "+a+". Must be a number. sizeMiddleSpread remains at: "+this._sizeMiddleSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"sizeEnd",{get:function(){return this._sizeEnd},set:function(a){"number"==typeof a?(this._sizeEnd=a,this._updateFlags.sizeEnd=!0,this._updateCounts.sizeEnd=0):console.warn("Invalid sizeEnd specified: "+a+". Must be a number. sizeEnd remains at: "+this._sizeEnd)}}),Object.defineProperty(SPE.Emitter.prototype,"sizeEndSpread",{get:function(){return this._sizeEndSpread},set:function(a){"number"==typeof a?(this._sizeEndSpread=a,this._updateFlags.sizeEnd=!0,this._updateCounts.sizeEnd=0):console.warn("Invalid sizeEndSpread specified: "+a+". Must be a number. sizeEndSpread remains at: "+this._sizeEndSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"colorStart",{get:function(){return this._colorStart},set:function(a){a instanceof THREE.Color?(this._colorStart=a,this._updateFlags.colorStart=!0,this._updateCounts.colorStart=0):console.warn("Invalid colorStart specified: "+a+". Must be instance of THREE.Color. colorStart remains at: "+this._colorStart)}}),Object.defineProperty(SPE.Emitter.prototype,"colorStartSpread",{get:function(){return this._colorStartSpread},set:function(a){a instanceof THREE.Vector3?(this._colorStartSpread=a,this._updateFlags.colorStart=!0,this._updateCounts.colorStart=0):console.warn("Invalid colorStartSpread specified: "+a+". Must be instance of THREE.Vector3. colorStartSpread remains at: "+this._colorStartSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"colorMiddle",{get:function(){return this._colorMiddle},set:function(a){a instanceof THREE.Color==!1?a=this._colorMiddle.addColors(this._colorStart,this._colorEnd).multiplyScalar(.5):a instanceof THREE.Color&&(this._colorMiddle=a),this._updateFlags.colorMiddle=!0,this._updateCounts.colorMiddle=0}}),Object.defineProperty(SPE.Emitter.prototype,"colorMiddleSpread",{get:function(){return this._colorMiddleSpread},set:function(a){a instanceof THREE.Vector3?(this._colorMiddleSpread=a,this._updateFlags.colorMiddle=!0,this._updateCounts.colorMiddle=0):console.warn("Invalid colorMiddleSpread specified: "+a+". Must be a number. colorMiddleSpread remains at: "+this._colorMiddleSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"colorEnd",{get:function(){return this._colorEnd},set:function(a){a instanceof THREE.Color?(this._colorEnd=a,this._updateFlags.colorEnd=!0,this._updateCounts.colorEnd=0):console.warn("Invalid colorEnd specified: "+a+". Must be instance of THREE.Color. colorEnd remains at: "+this._colorEnd)}}),Object.defineProperty(SPE.Emitter.prototype,"colorEndSpread",{get:function(){return this._colorEndSpread},set:function(a){a instanceof THREE.Vector3?(this._colorEndSpread=a,this._updateFlags.colorEnd=!0,this._updateCounts.colorEnd=0):console.warn("Invalid colorEndSpread specified: "+a+". Must be instance of THREE.Vector3. colorEndSpread remains at: "+this._colorEndSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"opacityStart",{get:function(){return this._opacityStart},set:function(a){"number"==typeof a?(this._opacityStart=a,this._updateFlags.opacityStart=!0,this._updateCounts.opacityStart=0):console.warn("Invalid opacityStart specified: "+a+". Must be a number. opacityStart remains at: "+this._opacityStart)}}),Object.defineProperty(SPE.Emitter.prototype,"opacityStartSpread",{get:function(){return this._opacityStartSpread},set:function(a){"number"==typeof a?(this._opacityStartSpread=a,this._updateFlags.opacityStart=!0,this._updateCounts.opacityStart=0):console.warn("Invalid opacityStartSpread specified: "+a+". Must be a number. opacityStartSpread remains at: "+this._opacityStartSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"opacityMiddle",{get:function(){return this._opacityMiddle},set:function(a){this._opacityMiddle="number"==typeof a?a:Math.abs(this._opacityEnd+this._opacityStart),this._updateFlags.opacityMiddle=!0,this._updateCounts.opacityMiddle=0}}),Object.defineProperty(SPE.Emitter.prototype,"opacityMiddleSpread",{get:function(){return this._opacityMiddleSpread},set:function(a){"number"==typeof a?(this._opacityMiddleSpread=a,this._updateFlags.opacityMiddle=!0,this._updateCounts.opacityMiddle=0):console.warn("Invalid opacityMiddleSpread specified: "+a+". Must be a number. opacityMiddleSpread remains at: "+this._opacityMiddleSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"opacityEnd",{get:function(){return this._opacityEnd},set:function(a){"number"==typeof a?(this._opacityEnd=a,this._updateFlags.opacityEnd=!0,this._updateCounts.opacityEnd=0):console.warn("Invalid opacityEnd specified: "+a+". Must be a number. opacityEnd remains at: "+this._opacityEnd)}}),Object.defineProperty(SPE.Emitter.prototype,"opacityEndSpread",{get:function(){return this._opacityEndSpread},set:function(a){"number"==typeof a?(this._opacityEndSpread=a,this._updateFlags.opacityEnd=!0,this._updateCounts.opacityEnd=0):console.warn("Invalid opacityEndSpread specified: "+a+". Must be a number. opacityEndSpread remains at: "+this._opacityEndSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"angleStart",{get:function(){return this._angleStart},set:function(a){"number"==typeof a?(this._angleStart=a,this._updateFlags.angleStart=!0,this._updateCounts.angleStart=0):console.warn("Invalid angleStart specified: "+a+". Must be a number. angleStart remains at: "+this._angleStart)}}),Object.defineProperty(SPE.Emitter.prototype,"angleStartSpread",{get:function(){return this._angleStartSpread},set:function(a){"number"==typeof a?(this._angleStartSpread=a,this._updateFlags.angleStart=!0,this._updateCounts.angleStart=0):console.warn("Invalid angleStartSpread specified: "+a+". Must be a number. angleStartSpread remains at: "+this._angleStartSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"angleMiddle",{get:function(){return this._angleMiddle},set:function(a){this._angleMiddle="number"==typeof a?a:Math.abs(this._angleEnd+this._angleStart),this._updateFlags.angleMiddle=!0,this._updateCounts.angleMiddle=0}}),Object.defineProperty(SPE.Emitter.prototype,"angleMiddleSpread",{get:function(){return this._angleMiddleSpread},set:function(a){"number"==typeof a?(this._angleMiddleSpread=a,this._updateFlags.angleMiddle=!0,this._updateCounts.angleMiddle=0):console.warn("Invalid angleMiddleSpread specified: "+a+". Must be a number. angleMiddleSpread remains at: "+this._angleMiddleSpread)}}),Object.defineProperty(SPE.Emitter.prototype,"angleEnd",{get:function(){return this._angleEnd},set:function(a){"number"==typeof a?(this._angleEnd=a,this._updateFlags.angleEnd=!0,this._updateCounts.angleEnd=0):console.warn("Invalid angleEnd specified: "+a+". Must be a number. angleEnd remains at: "+this._angleEnd)}}),Object.defineProperty(SPE.Emitter.prototype,"angleEndSpread",{get:function(){return this._angleEndSpread},set:function(a){"number"==typeof a?(this._angleEndSpread=a,this._updateFlags.angleEndSpread=!0,this._updateCounts.angleEndSpread=0):console.warn("Invalid angleEndSpread specified: "+a+". Must be a number. angleEndSpread remains at: "+this._angleEndSpread)
}});for(var i in SPE.utils)SPE.Emitter.prototype[i]=SPE.utils[i];